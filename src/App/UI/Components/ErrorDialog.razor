@inject ClipboardInterop Clipboard
@inject NavigationManager Navigation

<ErrorBoundary ChildContent="@ChildContent" @ref="@error">
    <ErrorContent Context="exception">
        <Dialog AutoOpen="true" @ref="@dialog">
            <h1 class="font-bold text-2xl">Exception Encountered!</h1>
            <Divider class="p-2" />

            <div class="max-w-prose py-2 space-y-2 text-base">
                <p>An exception was encountered that resulted in a critical failure of the application.</p>
            </div>

            <div class="flex flex-row items-center justify-between">
                <button type="button" class="icon" title="Copy Details" @onclick="@(() => OnCopyDetails(exception))">
                    <Icon Name="@IconName.CopyAll" Filled="false" Size="@TextSize.Large" />
                </button>

                <div class="flex flex-row items-center justify-end space-x-2">
                    <button type="button" class="flex flex-row group items-center" @onclick="@(() => Navigation.Refresh(true))">
                        Reload
                    </button>
                    @if (IsClosable)
                    {
                        <button type="button" class="flex flex-row group items-center" @onclick="@OnCloseClick">
                            Close
                        </button>
                    }
                </div>
            </div>
        </Dialog>
    </ErrorContent>
</ErrorBoundary>

@code {

    private ErrorBoundary? error;
    private Dialog? dialog;

    [EditorRequired]
    [Parameter]
    public RenderFragment ChildContent { get; init; } = default!;

    [Parameter]
    public bool IsClosable { get; init; }

    private Task OnCloseClick()
    {
        error!.Recover();
        return dialog!.Close();
    }

    private async Task OnCopyDetails(Exception exception)
    {
        var details = ErrorDetails.Create(exception);
        await Clipboard.Write(details.ToJsonString());
    }
}